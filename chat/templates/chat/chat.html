<!-- chat/templates/chat/chat.html -->

{% load static %}

<!DOCTYPE html>
<html>
<head>

  <!-- Meta -->
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0">

  <!-- Setup -->
  <title>TigerMeet</title>
  <link rel="icon" type="image/png" href="{% static 'cub.png' %}">

  <!-- Semantic UI -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/semantic-ui@2.4.2/dist/semantic.min.css">
  <script
  src="https://code.jquery.com/jquery-3.1.1.min.js"
  integrity="sha256-hVVnYaiADRTO2PzUGmuLJr8BLUSjGIZsDYGmIJLv2b8="
  crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/semantic-ui@2.4.2/dist/semantic.min.js"></script>

  <script type="text/javascript">
    //var token = {{ access_token }};
    var name = {{ group_name }};
    var url = "?access_token=" + {{ access_token }};
    var catname = {{ category_name }}
    var eventspage = '/category/' + catname + url;
    window.onload = function() 
    {
      //document.getElementById("myToken").innerHTML=token;
      document.getElementById("myName").innerHTML=name;
    }
  </script>
</head>
<body>
  <!-- Navbar -->
  <div class="ui pointing menu" style="margin-bottom: 0; border-radius: 0;">
    <a class="item" href="/">
      <img src="{% static 'cub.png' %}">
    </a>
    <div class="ui simple dropdown item">
      Chatrooms <i class="dropdown icon"></i>
      <div class="menu">
        <!-- Changes url to /chatname with the authentication token appended -->
        <a class="item" href="fill" onclick="location.href='/category/sports'+url; return false;" >
          <i class="futbol alternate icon"></i>
          Sports
        </a>
        <a class="item" href="fill" onclick="location.href='/category/workingout'+url; return false;" >
          <i class="heart icon"></i>
          Working Out
        </a>
        <a class="item" href="fill" onclick="location.href='/category/videogames'+url; return false;" >
          <i class="gamepad icon"></i>
          Video Games
        </a>
        <a class="item" href="fill" onclick="location.href='/category/transportation'+url; return false;" >
          <i class="car icon"></i>
          Transportation
        </a>
        <a class="item" href="fill" onclick="location.href='/category/problemsetgroups'+url; return false;" >
          <i class="pencil alternate icon"></i>
          Problem Set Groups
        </a>
        <a class="item" href="fill" onclick="location.href='/category/miscellaneous'+url; return false;" >
          <i class="ellipsis horizontal icon"></i>
          Miscellaneous
        </a>
      </div>
    </div>
    <div class="right menu">
      <a class="ui item" href="/about">
        About
      </a>
      <a class="ui item" href="/">
        Logout
      </a>
    </div>
  </div>

  <div class="ui middle aligned center aligned grid" style="margin: 10px;">
    <div class="column">

      <div>
        <button class="ui left floated button" type="button" onclick="location.href=eventspage;">Back to Category</button>
      </div>

      <br>
      <!-- Break -->
      <div style="clear:both"></div>

      <!--< id="myToken"> </a>-->
      <div class="ui positive message">
        <h1><a id="myName">chatname</a> GroupMe chat successfully created!</h1>
      </div>

      <script>
        $(document).ready(function()
        {
          $('#MyButton').click(function()
          {
            LaunchApp();
          });
        });
      </script>

      <br>
      <!-- Break -->
      <div style="clear:both"></div>

      <div class="ui buttons">
        <input class="ui primary button" type="button" value="Open in GroupMe (for iPhone)" id="MyButton">
        <div class="or"></div>
        <button class="ui positive button" type="button" onclick="location.href = 'https:/' + '/web.groupme.com/chats';">Open in Web</button>
      </div>

      <script type="text/javascript">
        // Detect if safari mobile
        function isMobileSafari() 
        {
          return navigator.userAgent.match(/(iPod|iPhone|iPad)/) && navigator.userAgent.match(/AppleWebKit/)
        }

        // Launch the element in your app if it's already installed on the phone
        function LaunchApp()
        {
          window.open("GroupMe://","_self");
        };

        if (isMobileSafari())
        {
          // To avoid the "protocol not supported" alert, fail must open itunes store to dl the app, add a link to your app on the store
          var appstorefail = "https://itunes.apple.com/app/GroupMe";
          var loadedAt = +new Date;
          setTimeout(
            function(){
              if (+new Date - loadedAt < 2000){
                window.location = appstorefail;
              }
            }
          ,100);
          LaunchApp()
        }
      </script>

    </div>
  </div>

</body>
</html>